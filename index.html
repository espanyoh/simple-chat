<html>
<head>
  <title>IO Chat</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body{
      margin:30px;
    }
    #messageArea{
      display:none;
      height: 500px;
    }
    #chat{
      height: 500px;
      overflow-x:hidden;
      overflow-y:visible;
    }
  </style>
</head>
<body>
  <div class="contrainer">
    <div id="userFormArea" class="row">
      <div class="col-md-12">
        <form id="userForm">
          <div class="form-group">
            <label> Enter username</label>
            <textarea class="form-control" id="username" onkeyup="enter_key('#userForm');"></textarea>
            <br />
            <input type="submit" class="btn btn-primary" value="Input username" />
          </div>
        </form>
      </div>
    </div>
  </div>

    <div class="row" id="messageArea">
      <div class="col-md-4">
        <div class="well">
          <h3> Online Users</h3>
          <ul class="list-group" id="users"></ul>
        </div>
      </div>

      <div class="col-md-8">
        <div class="chat" id="chat">
        </div>
        <div>
          <form id="messageForm">
            <div class="form-group">
              <label> Enter Message</label>
              <textarea class="form-control" id="message" onkeyup="enter_key('#messageForm');"></textarea>
              <br />
              <input type="submit" class="btn btn-primary" value="Send Message" />
            </div>
          </form>
        </div>
      </div>
  </div>


<script>
  $(function(){
    var socket = io.connect();
    var $messageForm = $('#messageForm');
    var $message = $('#message');
    var $chat = $('#chat');

    var $messageArea = $('#messageArea');
    var $userFormArea = $('#userFormArea');
    var $userForm = $('#userForm');
    var $users = $('#users');
    var $username = $('#username');

    $messageForm.submit(function(e){
      e.preventDefault();
      socket.emit('send message', $message.val());
      $message.val('');
    });

    socket.on('new message', function(data){
      $chat.append('<div class="well"><strong>'+data.username+'</strong> : '+data.msg+'</div>');
      //tempAlert("Message : "+data.msg,5000);
        var elem = document.getElementById('chat');
        elem.scrollTop = elem.scrollHeight;
    });

    $userForm.submit(function(e){
      e.preventDefault();
      socket.emit('new user', $username.val(),function(data){
        if(data){
          $userFormArea.hide();
          $messageArea.show();
        }
        //$username.val('');
      });
      $user.val('');
    });

    socket.on('get users', function(data){
      var html = '';
      for(i=0;i<data.length;i++){
        html += '<li class="list-group-item">'+data[i]+'</li>';
      }
      $users.html(html);
    })
  });

  // window.setInterval(function() {
  //   var elem = document.getElementById('chat');
  //   elem.scrollTop = elem.scrollHeight;
  // }, 1000);

  function enter_key(form) {
    var key = window.event.keyCode;
       if (key == 13) {
           $(form).submit();
       }
  }

  function tempAlert(msg,duration)
{
//  var el = document.createElement("div");
//  el.setAttribute("style","position:absolute;top:40%;left:20%;background-color:white;");
//  el.innerHTML = msg;
//  setTimeout(function(){
//   el.parentNode.removeChild(el);
//  },duration);
//  document.body.appendChild(el);
var result = confirm("Want to delete?");
if (result) {
    //Logic to delete the item
}
}

</script>

</body>
</html>
